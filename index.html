<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Agriturismo Giuggioloni - I sapori dell'AcquaViva</title>
<script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>
<link href="https://fonts.googleapis.com/css2?family=Be+Vietnam+Pro:ital,wght@0,300;0,400;0,500;0,600;0,700;1,400&amp;family=Playfair+Display:ital,wght@0,400;0,600;0,700;1,400&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:wght,FILL@100..700,0..1&amp;display=swap" rel="stylesheet"/>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" crossorigin="anonymous" referrerpolicy="no-referrer" />
<script id="tailwind-config">
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        "primary": "#E67E22",
                        "primary-dark": "#D35400",
                        "background-light": "#FDFBF7",
                        "background-cream": "#F5F0E6",
                        "background-dark": "#2C1810",
                        "earth-brown": "#8D6E63", 
                        "earth-light": "#EFEBE9",
                    },
                    fontFamily: {
                        "display": ["Be Vietnam Pro", "sans-serif"],
                        "serif": ["Playfair Display", "serif"],
                    },
                    borderRadius: {
                        "DEFAULT": "0.5rem",
                        "lg": "1rem",
                        "xl": "1.5rem",
                        "2xl": "2rem",
                        "full": "9999px"
                    },
                    backgroundImage: {
                        'texture-cream': "url('data:image/svg+xml,%3Csvg width=\\'100\\' height=\\'100\\' viewBox=\\'0 0 100 100\\' xmlns=\\'http://www.w3.org/2000/svg\\'%3E%3Cpath d=\\'M11 18c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm48 25c3.866 0 7-3.134 7-7s-3.134-7-7-7-7 3.134-7 7 3.134 7 7 7zm-43-7c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm63 31c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM34 90c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zm56-76c1.657 0 3-1.343 3-3s-1.343-3-3-3-3 1.343-3 3 1.343 3 3 3zM12 86c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm28-65c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm23-11c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-6 60c2.21 0 4-1.79 4-4s-1.79-4-4-4-4 1.79-4 4 1.79 4 4 4zm29 22c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zM32 63c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm57-13c2.76 0 5-2.24 5-5s-2.24-5-5-5-5 2.24-5 5 2.24 5 5 5zm-9-21c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM60 91c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM35 41c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2zM12 60c1.105 0 2-.895 2-2s-.895-2-2-2-2 .895-2 2 .895 2 2 2z\\' fill=\\'%23e67e22\\' fill-opacity=\\'0.03\\' fill-rule=\\'evenodd\\'/%3E%3C/svg%3E')",
                    }
                },
            },
        }
    </script>
<style>
        .text-shadow {
            text-shadow: 0 2px 4px rgba(0,0,0,0.4);
        }
        .text-shadow-light {
            text-shadow: 0 1px 2px rgba(0,0,0,0.2);
        }html { scroll-behavior: smooth; }.warm-filter {
            filter: sepia(20%) saturate(120%) contrast(105%);
        }
        /* small helper to avoid body jump when locking scroll */
        .lock-scroll {
          position: fixed;
          width: 100%;
        }
    </style>
<!-- Nuovo Style per navbar e header mobile -->
<style>
  /* variabile di default (fallback) */
  :root { --site-nav-height: 80px; }

  /* forza header a rispettare l'altezza della navbar e ad usare safe-area (notch) */
  header {
    padding-top: calc(var(--site-nav-height) + env(safe-area-inset-top, 0px));
    box-sizing: border-box;
    /* important per annullare l'overflow-visible attuale che taglia l'indicatore "Scorri" */
    overflow: visible !important;
  }

  /* regola minima dell'hero su desktop considerando nav */
  @media (min-width: 768px) {
    :root { --site-nav-height: 96px; } /* fallback per desktop */
    header {
      min-height: calc(100vh - var(--site-nav-height));
    }
  }

  /* Indicatore "Scorri" — posizione più sicura e visibile sopra il contenuto */
  .scroll-indicator {
    position: absolute;
    bottom: clamp(12px, 4vw, 28px);
    left: 50%;
    transform: translateX(-50%);
    z-index: 60; /* sopra il contenuto ma sotto la navbar (navbar ha z-50; 60 è ok se vuoi sovrapporre) */
    pointer-events: none;
    overflow: visible;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
    opacity: .95;
  }

  /* Se vuoi che l'indicatore stia sotto la navbar (non sopra), abbassa lo z-index a 30 */
  /* .scroll-indicator { z-index: 30; } */

  /* Title in hero: maggiore breathing on mobile */
  header .inline-block.border-y {
    padding-top: 0.4rem;
    padding-bottom: 0.4rem;
  }

  header .hero-title,
  header h1 {
    /* rendi il titolo più spazioso su mobile */
    margin-top: 0.15rem;
    margin-bottom: 0.4rem;
  }

  @media (max-width: 420px) {
    header h1 { font-size: 1.6rem !important; line-height: 1.05 !important; }
    header .inline-block.border-y { padding-left: 0.75rem; padding-right: 0.75rem; }
  }
</style>
<style>
  /* safe-area bottom var (iPhone home indicator) */
  :root { --safe-bottom-offset: env(safe-area-inset-bottom, 0px); }

  .scroll-indicator {
    position: absolute;
    left: 50%;
    transform: translateX(-50%);
    bottom: clamp(12px, 4vw, 28px);
    z-index: 40;               /* default: sotto le CTA che spesso hanno z-index più alto */
    pointer-events: none;
    overflow: visible;
    transition: bottom 220ms ease, opacity 180ms ease;
    max-width: 90%;
    text-align: center;
  }

  /* se vuoi una versione che non copra mai i bottoni, aumenta il bottom su schermi piccoli */
  @media (max-width: 420px) {
    .scroll-indicator { bottom: calc(14px + var(--safe-bottom-offset)); }
  }
</style>
<!-- FIX: mobile hero safety padding and flexible height -->
<style>
  :root { --safe-bottom-offset: env(safe-area-inset-bottom, 0px); }

  /* allow header to grow if content is taller than 62vh on small devices */
  @media (max-width: 767px) {
    header.min-h-\[62vh\], header {
      height: auto !important;
      min-height: 62vh !important;
      padding-bottom: calc(48px + var(--safe-bottom-offset));
    }
    header .relative.z-10 {
      padding-bottom: calc(48px + var(--safe-bottom-offset));
    }
    /* ensure the scroll indicator stays above safe area */
    .scroll-indicator { bottom: calc(12px + var(--safe-bottom-offset)) !important; }
  }

  /* ensure CTA buttons wrap nicely */
  header .relative.z-10 .flex { flex-wrap: wrap; gap: 0.5rem; }

  /* smaller font on very narrow devices (extra safety) */
  @media (max-width: 420px) {
    header h1 { font-size: 1.5rem !important; line-height: 1.05 !important; }
    .scroll-indicator { bottom: calc(18px + var(--safe-bottom-offset)) !important; }
  }
</style>


<!-- HORIZONTAL OVERFLOW FIX: prevent right-side white column and make images/buttons responsive -->
<style>
  /* Global box-sizing and prevent horizontal scroll */
  *, *::before, *::after { box-sizing: border-box; }
  html, body { max-width: 100%; overflow-x: hidden; }

  /* Ensure media scale down instead of overflowing */
  img, picture, svg, video, iframe { max-width: 100%; height: auto; display: block; }

  /* Override utilities that use 100vw which can cause horizontal overflow when scrollbars present */
  [class*="w-screen"], [style*="100vw"], .w-screen, .full-bleed, .full-width {
    width: 100% !important;
    max-width: 100% !important;
    left: 0 !important;
    right: 0 !important;
  }

  /* Make sure fixed elements don't create extra width */
  .fixed, .absolute { max-width: 100%; box-sizing: border-box; }

  /* Small devices: ensure hero can wrap and buttons don't force overflow */
  @media (max-width: 767px) {
    header, .hero, .min-h-\[62vh\] { overflow: visible !important; width: 100% !important; }
    header .relative.z-10 .flex { flex-wrap: wrap; gap: 0.5rem; }
  }
</style>

</head>
<body class="bg-background-cream dark:bg-background-dark text-gray-800 dark:text-gray-200 font-display transition-colors duration-300 bg-texture-cream">

<!-- ===== NAVBAR (updated for mobile UX) ===== -->
<nav id="siteNav" class="fixed w-full z-50 transition-all duration-300 bg-background-light/95 dark:bg-background-dark/95 backdrop-blur-md shadow-md border-b border-primary/10">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex justify-between items-center h-20 md:h-24">
      <div class="flex-shrink-0 flex items-center gap-3 group cursor-pointer">
        <div class="flex items-center justify-center w-12 h-12 md:w-16 md:h-16 bg-primary/10 p-2 rounded-full hover:bg-primary/20 transition-colors">
          <img src="logo.png" alt="logo Giuggioloni" class="w-10 h-10 md:w-12 md:h-12 object-contain">
        </div>
        <div class="flex flex-col">
          <span id="titolo" class="font-serif font-bold text-lg md:text-xl tracking-wide text-gray-900 dark:text-white leading-none">GIUGGIOLONI</span>
          <span id="sottotitolo" class="font-display text-primary font-medium text-xs md:text-sm tracking-widest uppercase">I sapori dell'AcquaViva</span>
        </div>
      </div>

      <!-- desktop links -->
      <div class="hidden md:flex space-x-8 items-center">
        <a class="text-gray-700 dark:text-gray-300 hover:text-primary dark:hover:text-primary transition-colors text-sm uppercase tracking-widest font-bold font-serif" href="#">Home</a>
        <a class="text-gray-700 dark:text-gray-300 hover:text-primary dark:hover:text-primary transition-colors text-sm uppercase tracking-widest font-bold font-serif" href="#ristorante">Il Ristorante</a>
        <a class="text-gray-700 dark:text-gray-300 hover:text-primary dark:hover:text-primary transition-colors text-sm uppercase tracking-widest font-bold font-serif" href="#fattoria">La Fattoria</a>
        <a class="text-gray-700 dark:text-gray-300 hover:text-primary dark:hover:text-primary transition-colors text-sm uppercase tracking-widest font-bold font-serif" href="#prodotti">Prodotti</a>
        <a class="bg-primary hover:bg-primary-dark text-white px-4 md:px-6 py-2.5 rounded-sm transition-colors text-sm font-bold uppercase tracking-wide shadow-lg shadow-primary/30 border border-primary-dark" href="#contatti">Contatti</a>
      </div>

      <!-- mobile button 
      <div class="md:hidden flex items-center">
        <button id="mobileMenuButton" class="text-gray-600 dark:text-gray-300 hover:text-primary p-2 rounded-md focus:outline-none" type="button"
                aria-controls="mobileMenu" aria-expanded="false" aria-label="Apri menu principale">
          <svg id="menuIconOpen" class="w-6 h-6" viewBox="0 0 24 24" fill="none"><path d="M4 6h16M4 12h16M4 18h16" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
          <svg id="menuIconClose" class="w-6 h-6 hidden" viewBox="0 0 24 24" fill="none"><path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
        </button>
      </div>
    </div>
  </div>
  -->
  <!-- MOBILE MENU: overlay + panel -->
  <div id="mobileOverlay" class="md:hidden fixed inset-0 bg-black/40 opacity-0 pointer-events-none transition-opacity duration-200 z-40"></div>

  <div id="mobileMenu" class="md:hidden fixed inset-x-0 top-[80px] z-50 -translate-y-2 opacity-0 pointer-events-none transition-all duration-250 ease-in-out">
    <div class="max-w-4xl mx-auto px-4">
      <div class="bg-background-light dark:bg-background-dark/95 rounded-b-md shadow-lg border-t border-primary/10 overflow-visible">
        <div class="p-5 space-y-4">
          <div class="flex items-center justify-between">
            <div class="flex items-center gap-3">
              <div class="w-10 h-10 bg-primary/10 rounded-md flex items-center justify-center"><img src="logo.png" alt="" class="w-8 h-8 object-contain"></div>
              <div>
                <div id="titolo" class="text-sm font-serif font-bold text-gray-900 dark:text-white">GIUGGIOLONI</div>
                <div id="sottotitolo" class="text-xs text-primary uppercase tracking-wider">I sapori dell'AcquaViva</div>
              </div>
            </div>
            <button id="mobileMenuClose" aria-label="Chiudi menu" class="p-2 rounded-md hover:bg-primary/5 focus:outline-none">
              <svg class="w-6 h-6" viewBox="0 0 24 24" fill="none"><path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/></svg>
            </button>
          </div>

          <nav role="menu" aria-label="Menu principale mobile" class="flex flex-col gap-2">
            <a role="menuitem" class="block py-3 px-3 rounded-md text-base font-bold text-gray-800 dark:text-gray-100 hover:bg-primary/5" href="#">Home</a>
            <a role="menuitem" class="block py-3 px-3 rounded-md text-base font-bold text-gray-800 dark:text-gray-100 hover:bg-primary/5" href="#ristorante">Il Ristorante</a>
            <a role="menuitem" class="block py-3 px-3 rounded-md text-base font-bold text-gray-800 dark:text-gray-100 hover:bg-primary/5" href="#fattoria">La Fattoria</a>
            <a role="menuitem" class="block py-3 px-3 rounded-md text-base font-bold text-gray-800 dark:text-gray-100 hover:bg-primary/5" href="#prodotti">Prodotti</a>
            <a role="menuitem" class="block py-3 px-3 rounded-md text-base font-bold bg-primary text-white text-center rounded-sm" href="#contatti">Contatti</a>
          </nav>

          <div class="pt-4 border-t border-stone-200 dark:border-stone-700">
            <div class="flex items-center gap-3">
              <a class="w-10 h-10 rounded-full bg-white/5 flex items-center justify-center text-gray-400 hover:text-white hover:bg-primary transition-all duration-300" href="#" aria-label="Instagram">
                <i class="fab fa-instagram text-lg"></i>
              </a>
              <a class="w-10 h-10 rounded-full bg-white/5 flex items-center justify-center text-gray-400 hover:text-white hover:bg-primary transition-all duration-300" href="#" aria-label="Facebook">
                <i class="fab fa-facebook text-lg"></i>
              </a>
              <a class="w-10 h-10 rounded-full bg-white/5 flex items-center justify-center text-gray-400 hover:text-white hover:bg-primary transition-all duration-300" href="#" aria-label="TikTok">
                <i class="fab fa-tiktok text-lg"></i>
              </a>
            </div>
          </div>

        </div>
      </div>
    </div>
  </div>
</nav>

<!-- ===== HERO: reduce height on small screens for faster rendering ===== -->
<header class="relative md:h-screen min-h-[62vh] min-h-[420px] flex items-center justify-center overflow-visible pt-12">
  <div class="absolute inset-0 z-0">
    <!-- hero image: keep high priority but avoid too big mobile impact -->
    <img
      alt="Golden hour landscape of rolling hills in Marche Italy with a stone farmhouse"
      class="w-full h-full object-cover warm-filter"
      src="https://lh3.googleusercontent.com/aida-public/AB6AXuAoUD7geav_jUt3YoxjGp1YMKk9g3P-yNxD8BvjTGZGLDlN8XlxnRMgkhZfvx0Fqxmiebje2SCK7_mXAcZFVCLDvQ50MNmHNuqBNqBv4-1Kn_OWbwo9kdXSvq-WYYgRGEwTdAcobigRFTWFud5rvX8YwiGUxxA6_dOmvZty8Q2e17MXTJ5LKQJK4Vee66USHGJGvmH1WxRe_42bqioJK9TssDU2ulaz0TzUok29ZUGMwfDsUBwRKvp_jWf5kHh18EpXFMQvHf4Wayk"
      decoding="async"
      fetchpriority="high"
      loading="eager"
      style="height:100%;"
    />
    <div class="absolute inset-0 bg-gradient-to-b from-black/30 via-black/20 to-black/50 mix-blend-multiply"></div>
    <div class="absolute inset-0 bg-orange-900/20 mix-blend-overlay"></div>
  </div>

  <div class="relative z-10 text-center px-4 max-w-5xl mx-auto mt-6 md:mt-16">
    <div class="inline-block border-y border-white/60 py-2 px-6 mb-4 backdrop-blur-sm bg-black/10">
      <span class="block text-white font-serif font-medium tracking-[0.2em] uppercase text-shadow-light"><p id="titolo"></p>Agriturismo nelle Marche</span>
    </div>

    <h1 class="text-3xl md:text-6xl font-serif font-bold text-white mb-4 md:mb-6 leading-tight text-shadow">
      Autenticità e Natura
      <br/>
      <span class="font-light italic text-orange-100 text-lg md:text-3xl">Sulla Tua Tavola</span>
    </h1>

    <p class="text-sm md:text-lg text-orange-50 mb-6 max-w-2xl mx-auto font-light leading-relaxed text-shadow font-serif">
      Un rifugio di pace tra le colline dorate, dove i sapori della terra incontrano la calda tradizione dell'ospitalità marchigiana.
    </p>

    <div class="flex flex-col sm:flex-row gap-3 sm:gap-5 justify-center">
      <a class="bg-primary hover:bg-primary-dark text-white text-base md:text-lg px-6 md:px-10 py-3 md:py-4 rounded-sm transition-all duration-300 shadow-lg transform hover:-translate-y-0.5 font-serif uppercase tracking-wider border-b-2 border-primary-dark" href="#ristorante">
        Prenota un Tavolo
      </a>
      <a class="bg-white/10 hover:bg-white/20 backdrop-blur-md border border-white/60 text-white text-base md:text-lg px-6 md:px-10 py-3 md:py-4 rounded-sm transition-all duration-300 font-serif uppercase tracking-wider hover:border-primary hover:text-primary" href="#fattoria">
        Scopri la Fattoria
      </a>
    </div>
  </div>
  <div class="scroll-indicator absolute bottom-0 transform text-white animate-bounce flex flex-col items-center gap-2 opacity-80 pointer-events-none">
    <span class="text-xs uppercase tracking-widest font-light">Scorri</span>
    <span class="material-icons text-3xl">keyboard_arrow_down</span>
  </div>
</header>

<!-- ===== rest of content preserved (kept your original structure) ===== -->
<section class="py-24 bg-background-light dark:bg-background-dark relative overflow-visible">
  <div class="absolute top-0 right-0 w-96 h-96 bg-primary/5 rounded-full blur-3xl -mr-32 -mt-32"></div>
  <div class="absolute bottom-0 left-0 w-64 h-64 bg-earth-brown/10 rounded-full blur-3xl -ml-20 -mb-20"></div>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
    <div class="text-center mb-20">
      <span class="text-primary text-sm font-bold tracking-widest uppercase mb-3 block font-serif">La Nostra Filosofia</span>
      <h2 class="text-3xl md:text-5xl font-serif font-bold text-gray-900 dark:text-white mb-6">Dal Campo alla Tavola</h2>
      <div class="flex justify-center items-center gap-4">
        <div class="h-px w-12 bg-primary/50"></div>
        <span class="material-icons text-primary">spa</span>
        <div class="h-px w-12 bg-primary/50"></div>
      </div>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-3 gap-12" data-repeat="cards">
      <template>
        <div class="bg-background-cream dark:bg-white/5 p-8 md:p-10 rounded-sm shadow-md hover:shadow-xl transition-all duration-300 border-t-4 border-primary group relative overflow-visible">
          <div class="absolute top-0 right-0 p-4 opacity-10 group-hover:opacity-20 transition-opacity">
            <span class="material-icons text-7xl text-primary">{{icona}}</span>
          </div>

          <div class="w-14 h-14 bg-primary/10 rounded-full flex items-center justify-center mb-6 group-hover:bg-primary group-hover:text-white transition-colors text-primary border border-primary/20">
            <span class="material-icons text-3xl">{{icona}}</span>
          </div>

          <h3 class="text-xl md:text-2xl font-serif font-bold mb-3 text-gray-900 dark:text-white">{{titolo}}</h3>

          <p class="text-gray-600 dark:text-gray-400 leading-relaxed font-light">
            {{valore}}
          </p>
        </div>
      </template>
    </div>
  </div>
</section>

<section class="py-24 bg-background-cream dark:bg-white/5 border-y border-stone-200 dark:border-stone-800" id="ristorante">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex flex-col lg:flex-row items-center gap-20">
      <div class="w-full lg:w-1/2 order-2 lg:order-1">
        <span class="text-primary font-bold tracking-widest uppercase mb-3 block font-serif">I Nostri Piatti</span>

        <h2 id="menuTitle" class="text-2xl md:text-5xl font-serif font-bold text-gray-900 dark:text-white mb-4 md:mb-8">Sapori di Stagione</h2>
        <p id="menuDescription" class="text-gray-600 dark:text-gray-300 mb-6 text-base md:text-lg leading-relaxed font-light">
          La nostra cucina è un omaggio alla tradizione contadina. Ogni piatto racconta una storia...
        </p>

        <div id="menuDaySelector" class="flex gap-2 flex-wrap" role="tablist" aria-label="Seleziona giorno menu"></div>

        <div class="mb-8 bg-white dark:bg-stone-900 p-4 shadow-sm border border-stone-100 dark:border-stone-800 rounded-sm">
          <table class="w-full" role="table">
            <caption class="sr-only">Menu — piatti e prezzi</caption>
            <tbody id="menuTableBody"></tbody>
          </table>
        </div>

        <a class="inline-flex items-center text-primary hover:text-primary-dark font-bold uppercase tracking-widest text-sm group border-b-2 border-primary pb-1 hover:border-primary-dark transition-all" href="#">
          Scopri il Menu Completo 
          <span class="material-icons ml-2 transform group-hover:translate-x-1 transition-transform">arrow_forward</span>
        </a>
      </div>

      <!-- colonna immagini: lo script popolerà #restaurantImages -->
      <div class="w-full lg:w-1/2 order-1 lg:order-2 grid grid-cols-2 gap-6 relative" id="restaurantImagesWrap">
        <div class="absolute -top-4 -left-4 w-24 h-24 bg-primary/20 z-0 rounded-full blur-2xl"></div>
        <div id="restaurantImages" class="grid grid-cols-2 gap-6 w-full z-10"></div>
      </div>
    </div>
  </div>
</section>

<section class="py-24 bg-background-light dark:bg-background-dark" id="fattoria">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="text-center mb-16">
      <span class="text-primary font-bold tracking-widest uppercase mb-3 block font-serif">La Fattoria</span>
      <h2 class="text-3xl md:text-4xl font-serif font-bold text-gray-900 dark:text-white">Vita in Campagna</h2>
      <p class="mt-6 text-gray-600 dark:text-gray-400 max-w-2xl mx-auto font-light text-base md:text-lg">
        Passeggiate tra gli animali, visitate l'orto didattico e riscoprite il contatto primordiale con la natura e i suoi frutti.
      </p>
    </div>

    <div class="grid grid-cols-1 md:grid-cols-4 grid-rows-2 gap-6 h-auto md:h-[650px]">
      <div class="md:col-span-2 md:row-span-2 relative group overflow-visible rounded-sm shadow-lg">
        <div class="absolute inset-0 bg-primary/20 mix-blend-overlay z-10 pointer-events-none"></div>
        <img alt="Close up of a sheep in a green pasture" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105 warm-filter" data-alt="Close up of a sheep in a green pasture" src="https://lh3.googleusercontent.com/aida-public/AB6AXuBWziVyQPUR9IPBhjPTs7xn0DdS4uk7BK-2SVzFZjOVOQ14V7VFLEVMLaiMgAaD21qoIm08t1L-5fcUispO1p4njUdcty67rxgHrWHH1MZeNnHQ4DrwU3PRlNytbx-ovgwAe2fDA_vWWqKnKjIdeDVHRucGBd7hhzAdvWUwerj47YadtfdNnOY6tncwhd6g6TjDHJ3wCJFDa64USRfy8YWCuZSzcpa-Dxpdm8BA9le52BwJULCs2wYE-29ULeyY4YLCMjKYLg1_1h8"  decoding="async"/>
        <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent opacity-90 transition-opacity duration-300 flex items-end p-8 z-20">
          <div>
            <span class="text-primary text-xs font-bold uppercase tracking-wider mb-2 block">Animali</span>
            <p class="text-white font-serif text-2xl">I nostri animali al pascolo</p>
          </div>
        </div>
      </div>

      <div class="md:col-span-2 relative group overflow-visible rounded-sm shadow-lg">
        <div class="absolute inset-0 bg-primary/20 mix-blend-overlay z-10 pointer-events-none"></div>
        <img alt="Vegetable garden rows with lush green plants" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105 warm-filter" data-alt="Vegetable garden rows with lush green plants" src="https://lh3.googleusercontent.com/aida-public/AB6AXuCThB2qZrgnOxLSXqSQ73E8Y2HwHrqvFuwk0bNdSNgYF_BV3SNCRvcy1ah-A67nRXzRFA8Nf3Y_5lVQreiKptW_J3pKuVU279SFjs14fhPajvpdX33fb2pOg_q-7E9veWIRIVm9oa5pUuOOzNAAlnuxkU3Kh534XF13DKJcfVshpolKZjtIuttNaJs99Ie85ZuJtAZTTet99aMYGeLiKWTl_dKNjtNu4ZVEz2oIfbupJCQSj3eF5ITYUHwNsKypOVgxchh3ieYjeUc"  decoding="async"/>
        <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent opacity-90 transition-opacity duration-300 flex items-end p-8 z-20">
          <div>
            <span class="text-primary text-xs font-bold uppercase tracking-wider mb-2 block">Coltivazioni</span>
            <p class="text-white font-serif text-2xl">L'orto sinergico</p>
          </div>
        </div>
      </div>

      <div class="relative group overflow-visible rounded-sm shadow-lg">
        <div class="absolute inset-0 bg-primary/20 mix-blend-overlay z-10 pointer-events-none"></div>
        <img alt="Basket of fresh red tomatoes" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105 warm-filter" data-alt="Basket of fresh red tomatoes" src="https://lh3.googleusercontent.com/aida-public/AB6AXuCTxtBQbow9zqZ6vvSMF2s325_tGzOe-t2mJyBZAylJqE9FkvMA2ai_t7ivWDd3IaJK5N-FYmBGoBuNfgJgS1Oj3AlZujT41BFRJ6yCluRCAVYIW-6e5viVnJq123ZyLx6uwmVGo0GMcGxu0ucx9SHd-H4hbO3_mBI3XiPEFM9UjSfAonmHHvAtMIdI1xCAqTmp_ahA2g9NlzwUaxeIhx9Awal4QYDDWe4M3TEoLcr2d0gx639Dh3sUdXT5W5ZqcHV6rf04ZjiS5Ko"  decoding="async"/>
        <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent opacity-90 transition-opacity duration-300 flex items-end p-6 z-20">
          <p class="text-white font-serif text-lg">Il raccolto</p>
        </div>
      </div>

      <div class="relative group overflow-visible rounded-sm shadow-lg">
        <div class="absolute inset-0 bg-primary/20 mix-blend-overlay z-10 pointer-events-none"></div>
        <img alt="Rustic wooden table set for outdoor dining" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105 warm-filter" data-alt="Rustic wooden table set for outdoor dining" src="https://lh3.googleusercontent.com/aida-public/AB6AXuC9tOR37FR5wnavO8jkjGfWYE89qCoqDwxg-v3pGYEkgU8iFpLhMur_o5jaUnNnhe7uXo6LjkcIxl4eAymAOWWNT64g5ZiwsWnU3BOoWjpOUlhtzly88eFOs0w03nkrohpREP9b1pOwUv6pRXm86HTTe7woQFoUJL0nf0OOZf_NuFQPPmNRDnInhGxfDXoCnmvVDt7FFKrrMZaIHJkFgOgk-i8ODmxEgFyj98got6mu06PULTYhvsa3GiXCrczMYfvJ_YWRumU7MfM"  decoding="async"/>
        <div class="absolute inset-0 bg-gradient-to-t from-black/80 via-transparent to-transparent opacity-90 transition-opacity duration-300 flex items-end p-6 z-20">
          <p class="text-white font-serif text-lg">Relax all'aperto</p>
        </div>
      </div>
    </div>
  </div>
</section>

<section class="py-20 bg-primary relative overflow-visible" id="prodotti">
  <div class="absolute inset-0 bg-[url('https://www.transparenttextures.com/patterns/wood-pattern.png')] opacity-10"></div>
  <div class="absolute inset-0 bg-gradient-to-r from-orange-300 mix-blend-multiply"></div>
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 relative z-10">
    <div class="flex flex-col md:flex-row items-center justify-between gap-12 text-center md:text-left">
      <div class="md:w-2/3">
        <h2 class="text-2xl md:text-3xl font-serif font-bold mb-4 text-white">Porta a casa i sapori dell'agriturismo</h2>
        <p class="text-orange-50 text-base md:text-lg font-light leading-relaxed">
          Olio extravergine d'oliva, confetture fatte in casa, vini locali e miele dorato. I nostri prodotti sono disponibili per l'acquisto diretto in azienda.
        </p>
      </div>
      <div class="md:w-1/3 flex justify-center md:justify-end">
        <a href="/shop.html" target="_blank" rel="noopener noreferrer">
          <button class="bg-white text-primary hover:bg-orange-50 hover:text-primary-dark font-serif font-bold py-3 px-6 md:py-4 md:px-10 rounded-sm shadow-xl transition-colors border-b-4 border-orange-200">Scopri i Prodotti!</button>
        </a>
      </div>
    </div>
  </div>
</section>

<footer class="bg-background-dark text-gray-300 pt-16 pb-10 border-t-4 border-primary" id="contatti">
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-12 mb-12">
      <div>
        <div class="flex items-center gap-3 mb-6">
          <div class="flex items-center justify-center bg-primary/20 p-2 rounded-full">
            <img src="logo.png" alt="logo Giuggioloni" class="w-10 h-10 object-contain">
          </div>
          <div class="flex flex-col">
            <span id="titolo" class="font-serif font-bold text-lg text-white leading-none tracking-wide">GIUGGIOLONI</span>
            <span id="sottotitolo" class="text-xs text-primary uppercase tracking-widest">I sapori dell'AcquaViva</span>
          </div>
        </div>
        <p id="descrizione" class="text-sm leading-relaxed mb-6 text-gray-400 font-light">
          Un angolo di paradiso nelle Marche dove riscoprire i sapori autentici e la bellezza della vita semplice, immersi nei colori caldi della natura.
        </p>
        <div class="flex space-x-4">
          <a class="w-10 h-10 rounded-full bg-white/5 flex items-center justify-center text-gray-400 hover:text-white hover:bg-primary transition-all duration-300" data-social="facebook" id="footerFacebook" href="#" target="_blank" rel="noopener noreferrer" aria-label="Facebook Giuggioloni"><i class="fab fa-facebook text-lg" aria-hidden="true"></i></a>
          <a class="w-10 h-10 rounded-full bg-white/5 flex items-center justify-center text-gray-400 hover:text-white hover:bg-primary transition-all duration-300" data-social="instagram" id="footerInstagram" href="#" target="_blank" rel="noopener noreferrer" aria-label="Instagram Giuggioloni"><i class="fab fa-instagram text-lg" aria-hidden="true"></i></a>
          <a class="w-10 h-10 rounded-full bg-white/5 flex items-center justify-center text-gray-400 hover:text-white hover:bg-primary transition-all duration-300" data-social="tiktok" id="footerTiktok" href="#" target="_blank" rel="noopener noreferrer" aria-label="TikTok Giuggioloni"><i class="fab fa-tiktok text-lg" aria-hidden="true"></i></a>
        </div>
      </div>

      <div>
        <h3 class="text-white font-serif font-bold text-xl mb-6 relative inline-block">Esplora<span class="absolute -bottom-2 left-0 w-12 h-1 bg-primary rounded-full"></span></h3>
        <ul class="space-y-4 text-sm font-light">
          <li><a class="hover:text-primary transition-colors flex items-center gap-2 group" href="storia.html"><span class="material-icons text-xs text-primary opacity-0 group-hover:opacity-100 transition-opacity">chevron_right</span>La Nostra Storia</a></li>
          <li><a class="hover:text-primary transition-colors flex items-center gap-2 group" href="piatti.html"><span class="material-icons text-xs text-primary opacity-0 group-hover:opacity-100 transition-opacity">chevron_right</span>I Nostri Piatti</a></li>
          <li><a class="hover:text-primary transition-colors flex items-center gap-2 group" href="shop.html"><span class="material-icons text-xs text-primary opacity-0 group-hover:opacity-100 transition-opacity">chevron_right</span>I Nostri Prodotti</a></li>
        </ul>
      </div>

      <div>
        <h3 class="text-white font-serif font-bold text-xl mb-6 relative inline-block">Contatti<span class="absolute -bottom-2 left-0 w-12 h-1 bg-primary rounded-full"></span></h3>
        <ul class="space-y-6 text-sm font-light">
          <li class="flex items-start">
            <span class="material-icons text-primary text-lg mr-4 mt-0.5">location_on</span>
            <span><p id="indirizzo" data-bind="contatto.via"></p><p id="comune" data-bind="contatto.comune"></p></span>
          </li>
          <li class="flex items-center">
            <span class="material-icons text-primary text-lg mr-4">phone</span>
            <ul id="phoneList"></ul>
          </li>
          <li class="flex items-center">
            <span class="material-icons text-primary text-lg mr-4">email</span>
            <span><p id="email">info@isaporidellacquaviva.it</p></span>
          </li>
        </ul>
      </div>

      <div>
        <h3 class="text-white font-serif font-bold text-xl mb-6 relative inline-block">Orari<span class="absolute -bottom-2 left-0 w-12 h-1 bg-primary rounded-full"></span></h3>
        <ul id="orariList" class="space-y-3 text-sm font-light border-l border-white/10 pl-6">
          <li class="flex justify-between items-start"><span class="text-gray-400">Lunedì</span><span class="text-orange-400 font-medium w-28 min-w-[80px] text-right">Chiuso</span></li>
          <li class="flex justify-between items-start"><span class="text-gray-400">Giovedì</span><span class="text-white w-28 min-w-[80px] text-right">19:00-23:00</span></li>
          <li class="flex justify-between items-start"><span class="text-gray-400">Sabato</span><span class="text-white w-28 min-w-[80px] text-right">12:30-15:00<br>19:00-23:00</span></li>
        </ul>
      </div>
    </div>

    <div class="w-full h-64 md:h-72 bg-gray-800 rounded-sm overflow-visible mb-8 relative group border border-white/10">
      <img alt="Map showing location in Marche Italy" class="w-full h-full object-cover opacity-60 group-hover:opacity-40 transition-opacity filter sepia" data-alt="Abstract map representation of the Marche region location" data-location="Macerata, Marche" src="https://lh3.googleusercontent.com/aida-public/AB6AXuAH8Q-o1oh7m0Rk8tUwDrEXEoeCI8ENvM7RgZm_y34WZhk0cXEHllqB897KQRwtMD-ykVI5_1fEKEcQjFT8nbxnoYwXUAgvIQR_NnmHDawhEkPkB0t0Wosrx6W3E6iqSdTSb_aWYD4xaJjozUDC0PnWprW4xbkcSJCzuKDQ9jXNsNKzXUzoEGLQBPq9GgvgyvFtODYHU0fGJ_2FlKOXfxBbdvIU0buV8BnGyZjy3dLeTsFxQi54oz1dQkI9mCqdRsQ1sJ6SOSoH-Xs"  decoding="async" />
      <div class="absolute inset-0 flex items-center justify-center pointer-events-none">
        <div class="bg-background-dark/90 backdrop-blur-sm px-6 py-3 rounded-sm flex items-center gap-3 border border-primary/50 shadow-2xl">
          <span class="material-icons text-primary">map</span>
          <span class="text-white font-bold font-serif tracking-wide">Vedi su Mappa</span>
        </div>
      </div>
    </div>

    <div class="border-t border-gray-800 pt-8 flex flex-col md:flex-row justify-between items-center text-xs text-gray-500 font-light">
      <p>© 2026 I sapori dell'acquaviva. Tutti i diritti riservati.</p>
      <div class="flex space-x-6 mt-4 md:mt-0">
        <a class="hover:text-primary transition-colors" href="#">Privacy Policy</a>
        <a class="hover:text-primary transition-colors" href="#">Cookie Policy</a>
      </div>
    </div>
  </div>
</footer>

<!-- ===== NAV & MOBILE UX SCRIPT (focus trap, overlay, escape, close on link, scroll hide) ===== -->
<script>
(function(){
  const btn = document.getElementById('mobileMenuButton');
  const menu = document.getElementById('mobileMenu');
  const overlay = document.getElementById('mobileOverlay');
  const closeBtn = document.getElementById('mobileMenuClose');
  const iconOpen = document.getElementById('menuIconOpen');
  const iconClose = document.getElementById('menuIconClose');
  const siteNav = document.getElementById('siteNav');

  if (!btn || !menu || !overlay) return;

  let open = false;
  let lastFocused = null;
  let scrollLockApplied = false;

  // helper to toggle classes / aria
  function setOpen(state){
    open = !!state;
    btn.setAttribute('aria-expanded', String(open));
    if (open) {
      menu.classList.remove('-translate-y-2','opacity-0','pointer-events-none');
      menu.classList.add('translate-y-0','opacity-100');
      overlay.classList.remove('opacity-0','pointer-events-none');
      overlay.classList.add('opacity-100','pointer-events-auto');
      iconOpen.classList.add('hidden');
      iconClose.classList.remove('hidden');

      // lock scroll (lightweight)
      lastFocused = document.activeElement;
      document.documentElement.dataset.scrollTop = window.scrollY;
      document.documentElement.classList.add('lock-scroll');
      document.body.style.top = `-${window.scrollY}px`;
      document.body.style.position = 'fixed';
      document.body.style.width = '100%';
      scrollLockApplied = true;

      // focus first link
      const first = menu.querySelector('[role="menuitem"], a[href]');
      if (first) first.focus();

      // add key listener
      document.addEventListener('keydown', onKeydown, { passive: false });
    } else {
      menu.classList.add('-translate-y-2','opacity-0','pointer-events-none');
      menu.classList.remove('translate-y-0','opacity-100');
      overlay.classList.add('opacity-0','pointer-events-none');
      overlay.classList.remove('opacity-100','pointer-events-auto');
      iconOpen.classList.remove('hidden');
      iconClose.classList.add('hidden');

      // unlock scroll
      if (scrollLockApplied) {
        const y = parseInt(document.documentElement.dataset.scrollTop || '0', 10);
        document.documentElement.classList.remove('lock-scroll');
        document.body.style.position = '';
        document.body.style.top = '';
        document.body.style.width = '';
        window.scrollTo(0, y);
        scrollLockApplied = false;
      }

      if (lastFocused && lastFocused.focus) lastFocused.focus();
      document.removeEventListener('keydown', onKeydown, { passive: false });
    }
  }

  function onKeydown(e){
    if (e.key === 'Escape') { setOpen(false); return; }
    if (e.key === 'Tab' && open){
      // basic focus trap
      const focusables = Array.from(menu.querySelectorAll('a[href], button:not([disabled]), [tabindex]:not([tabindex="-1"])')).filter(el => el.offsetParent !== null);
      if (focusables.length === 0) return;
      const first = focusables[0], last = focusables[focusables.length - 1];
      if (e.shiftKey && document.activeElement === first){ e.preventDefault(); last.focus(); }
      else if (!e.shiftKey && document.activeElement === last){ e.preventDefault(); first.focus(); }
    }
  }

  // close on overlay click
  overlay.addEventListener('click', () => setOpen(false));
  closeBtn && closeBtn.addEventListener('click', () => setOpen(false));

  // toggle button
  btn.addEventListener('click', (e) => { e.preventDefault(); setOpen(!open); });

  // close on link click (allow anchor to navigate then close)
  menu.addEventListener('click', (ev) => {
    const a = ev.target.closest('a[href^="#"], a[role="menuitem"]');
    if (a) {
      setTimeout(()=> setOpen(false), 120);
    }
  });

  // ensure closed on resize to desktop
  window.addEventListener('resize', () => { if (window.innerWidth >= 768 && open) setOpen(false); });

  // NAV hide on scroll down / show on scroll up (mobile only)
  let lastScroll = window.scrollY;
  let ticking = false;
  function onScroll(){
    if (window.innerWidth >= 768) return;
    const current = window.scrollY;
    if (!ticking){
      window.requestAnimationFrame(() => {
        if (current > lastScroll && current > 80) {
          // scrolling down
          siteNav.style.transform = 'translateY(-110%)';
        } else {
          siteNav.style.transform = 'translateY(0)';
        }
        lastScroll = current;
        ticking = false;
      });
      ticking = true;
    }
  }
  window.addEventListener('scroll', onScroll, { passive: true });

  // Initialize state (ensure classes for closed)
  menu.classList.add('-translate-y-2','opacity-0','pointer-events-none');
  overlay.classList.add('opacity-0','pointer-events-none');
  iconClose.classList.add('hidden');

})();
</script>

<!-- ===== your original unifiedScriptsWithImages kept; lazy-loading already applied to many images above () ===== -->
<script>
(async function unifiedScriptsWithImages() {
  // CONFIG: aggiorna i percorsi se necessario
  const MENU_JSON_PATH = '/menu.json';
  const DATA_JSON_PATH = '/dati.json';

  // ---------- HELPERS ----------
  function escapeHtml(str = '') {
    return String(str)
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;')
      .replace(/"/g, '&quot;')
      .replace(/'/g, '&#39;');
  }

  function formatPrice(p) {
    if (p === null || p === undefined || p === '') return '';
    if (typeof p === 'string' && (p.includes('€') || p.includes(','))) return p;
    const num = Number(String(p).replace(',', '.'));
    if (isNaN(num)) return String(p);
    return Number.isInteger(num) ? `€${num}` : `€${num.toFixed(2).replace('.', ',')}`;
  }

  function getTodayItalianLower() {
    try {
      const now = new Date();
      const day = new Intl.DateTimeFormat('it-IT', { weekday: 'long', timeZone: 'Europe/Rome' }).format(now);
      return day.toLowerCase();
    } catch {
      const fallback = ['domenica','lunedì','martedì','mercoledì','giovedì','venerdì','sabato'];
      return fallback[new Date().getDay()];
    }
  }

  function capitalizeFirst(s) {
    if (!s) return s;
    return s[0].toUpperCase() + s.slice(1);
  }

  // leggi path 'a.b[0].c' su un oggetto
  function getValueByPath(obj, path) {
    if (!path) return undefined;
    const normalized = path.replace(/\[(\d+)\]/g, '.$1');
    return normalized.split('.').reduce((acc, key) => (acc == null ? undefined : acc[key]), obj);
  }

  // render mustache semplice: {{path.to.val}} - usa getValueByPath
  function renderTemplateString(template, data) {
    if (!template || typeof template !== 'string') return '';
    return template.replace(/\{\{\s*([^}\s]+(?:\.[^}\s]+|\[\d+\])*)\s*\}\}/g, (m, p1) => {
      const val = getValueByPath(data, p1);
      if (val === null || val === undefined) return '';
      return escapeHtml(String(val));
    });
  }

  // process data-repeat containers and simple bindings (attributes + innerHTML)
  function processRepeats(root, data) {
    const repeats = root.querySelectorAll('[data-repeat]');
    repeats.forEach(container => {
      const path = container.dataset.repeat;
      const arr = getValueByPath(data, path) || [];
      const tplEl = container.querySelector('template');
      const tpl = tplEl ? tplEl.innerHTML : container.innerHTML;
      const itemsHtml = Array.isArray(arr)
        ? arr.map(item => renderTemplateString(tpl, item)).join('')
        : '';
      container.innerHTML = itemsHtml;
    });
  }

  function bindAll(root, data) {
    const all = root.querySelectorAll('*');
    all.forEach(el => {
      // attributes
      for (const { name, value } of Array.from(el.attributes)) {
        if (value && value.includes('{{')) {
          const out = renderTemplateString(value, data);
          el.setAttribute(name, out);
        }
      }
      // innerHTML (escaped)
      if (el.innerHTML && el.innerHTML.includes('{{')) {
        el.innerHTML = renderTemplateString(el.innerHTML, data);
      }
    });
  }

  // ---------- MENU RENDER ----------
  function renderDishes(tbodyEl, dishes) {
    tbodyEl.innerHTML = '';
    if (!Array.isArray(dishes) || dishes.length === 0) {
      tbodyEl.innerHTML = `<tr><td class="py-4" colspan="2">Nessun piatto disponibile per questo giorno.</td></tr>`;
      return;
    }
    const frag = document.createDocumentFragment();
    for (const dish of dishes) {
      const tr = document.createElement('tr');
      tr.className = 'border-b border-dashed border-stone-300 dark:border-stone-700 last:border-b-0';
      const name = escapeHtml(dish.name || dish.title || '');
      const desc = escapeHtml(dish.description || '');
      const price = (dish.price_display && String(dish.price_display).trim() !== '') ? escapeHtml(dish.price_display) : formatPrice(dish.price);
      tr.innerHTML = `
        <td class="py-4 align-top">
          <div>
            <h4 class="text-lg font-serif font-bold text-gray-800 dark:text-gray-100">${name}</h4>
            <p class="text-sm text-gray-500 dark:text-gray-400 mt-1 italic">${desc}</p>
          </div>
        </td>
        <td class="py-4 align-top w-28 text-right">
          <span class="text-primary font-bold text-lg font-serif">${price}</span>
        </td>
      `;
      frag.appendChild(tr);
    }
    tbodyEl.appendChild(frag);
  }

  function buildDaySelector(container, daysArray, selectedDay, onSelect) {
    container.innerHTML = '';
    const frag = document.createDocumentFragment();
    for (const item of daysArray) {
      const btn = document.createElement('button');
      btn.type = 'button';
      btn.className = 'px-3 py-1 rounded-md text-sm font-medium border transition-colors';
      btn.dataset.day = item.key;
      btn.setAttribute('role', 'tab');
      btn.innerHTML = `${escapeHtml(capitalizeFirst(item.key))}${item.isToday ? ' <span class="sr-only">(oggi)</span>' : ''}`;
      if (item.key === selectedDay) {
        btn.classList.add('border-primary','text-primary','bg-white','dark:bg-stone-800');
        btn.setAttribute('aria-selected', 'true');
      } else {
        btn.classList.add('border-stone-200','dark:border-stone-700','text-gray-700','dark:text-gray-300','bg-white','dark:bg-stone-800');
        btn.setAttribute('aria-selected','false');
      }
      btn.addEventListener('click', () => onSelect(item.key));
      frag.appendChild(btn);
    }
    container.appendChild(frag);
  }

  // ---------- DATI JSON DOM UPDATES ----------
  function applyDatiToDOM(dati) {
    if (!dati || typeof dati !== 'object') return;

    // Social
    const ig = dati.socials?.instagram?.link;
    const fb = dati.socials?.facebook?.link;
    const tt = dati.socials?.tiktok?.link;
    if (ig && document.querySelector('#footerInstagram')) document.querySelector('#footerInstagram').href = ig;
    if (fb && document.querySelector('#footerFacebook')) document.querySelector('#footerFacebook').href = fb;
    if (tt && document.querySelector('#footerTiktok')) document.querySelector('#footerTiktok').href = tt;

    // Contatto
    if (dati.contatto) {
      if (document.querySelector('#indirizzo')) document.querySelector('#indirizzo').innerText = (dati.contatto.via || '');
      if (document.querySelector('#comune')) document.querySelector('#comune').innerText = (dati.contatto.comune ? dati.contatto.comune : '');
      if (document.querySelector('#telefono')) document.querySelector('#telefono').innerText = dati.contatto.numeri_telefono;
      if (document.querySelector('#email')) document.querySelector('#email').innerText = dati.contatto.mail || '';
    }

    // Shop
    if (dati.shop) {
      if (document.querySelector('#introduzione')) document.querySelector('#introduzione').innerText = (dati.shop.introduzione ? dati.shop.introduzione : '');
      if (document.querySelector('#introduzione1')) document.querySelector('#introduzione1').innerText = (dati.shop.introduzione1 ? dati.shop.introduzione1 : '');
    }

    // Home dati
    if (dati.home) {
      if (document.querySelector('#titolo')) document.querySelector('#titolo').innerText = (dati.home.titolo || '');
      if (document.querySelector('#sottotitolo')) document.querySelector('#sottotitolo').innerText = (dati.home.sottotitolo || '');
      if (document.querySelector('#descrizione')) document.querySelector('#descrizione').innerText = dati.home.descrizione;
      if (document.querySelector('#frase1')) document.querySelector('#frase1').innerText = dati.home.frase1 || '';
      if (document.querySelector('#frase11')) document.querySelector('#frase11').innerText = dati.home.frase11 || '';
      if (document.querySelector('#frase2')) document.querySelector('#frase2').innerText = dati.home.frase2 || '';
    }

    if (Array.isArray(dati.contatto?.numeri_telefono) && document.getElementById('phoneList')) {
      const wrap = document.getElementById('phoneList');
      wrap.innerHTML = '';
      const frag = document.createDocumentFragment();
      dati.contatto.numeri_telefono.forEach(num => {
        const li = document.createElement('li');
        li.textContent = num;
        frag.appendChild(li);
      });
      wrap.appendChild(frag);
    }

    // Orari -> #orariList (se presente)
    if (dati.orari && document.querySelector('#orariList')) {
      const wrap = document.querySelector('#orariList');
      wrap.innerHTML = '';
      const frag = document.createDocumentFragment();
      Object.keys(dati.orari).forEach(day => {
        const d = dati.orari[day];
        const li = document.createElement('li');
        li.className = 'flex justify-between items-start';
        if (d.note === 'Cena' || d.note === 'Pranzo'){
          li.innerHTML = `<span class="text-gray-400">${escapeHtml(day)}</span><span class="text-white w-28 min-w-[80px] text-right">${escapeHtml((d.pranzo||'') + (d.cena ? d.cena : ''))}</span>`;
        } else if (d.note === 'Aperto') {
          li.innerHTML = `<span class="text-gray-400">${escapeHtml(day)}</span><span class="text-white w-28 min-w-[80px] text-right">${escapeHtml((d.pranzo||''))} <br>${escapeHtml((d.cena ? (d.cena) : ''))}</span>`;
        } else{
          li.innerHTML = `<span class="text-gray-400">${escapeHtml(day)}</span><span class="text-orange-400 font-medium w-28 min-w-[80px] text-right">${escapeHtml((d.pranzo||'') + (d.cena ? (' • ' + d.cena) : '') + (d.note ? (d.note) : ''))}</span>`;
        }
        frag.appendChild(li);
      });
      wrap.className = 'space-y-3 text-sm font-light border-l border-white/10 pl-6';
      wrap.appendChild(frag);
    }

    // Cards -> #cardsContainer (se presente)
    if (Array.isArray(dati.cards) && document.querySelector('#cardsContainer')) {
      const cwrap = document.querySelector('#cardsContainer');
      cwrap.innerHTML = '';
      const frag = document.createDocumentFragment();
      dati.cards.forEach(c => {
        const el = document.createElement('article');
        el.className = 'p-4 border rounded mb-3 bg-background-cream dark:bg-white/5';
        el.innerHTML = `<h4 class="font-semibold">${escapeHtml(c.titolo)}</h4><p class="text-sm">${escapeHtml(c.valore)}</p>`;
        frag.appendChild(el);
      });
      cwrap.appendChild(frag);
    }
  }

  // ---------- RESTAURANT IMAGES FROM menu.json ----------
  function extractImagesFromMenu(menuJson) {
    if (!menuJson || !menuJson.days || typeof menuJson.days !== 'object') return [];
    const seen = new Set();
    const images = [];
    for (const rawKey of Object.keys(menuJson.days)) {
      const dayEntry = menuJson.days[rawKey] || {};
      if (!dayEntry || !Array.isArray(dayEntry.dishes)) continue;
      for (const dish of dayEntry.dishes) {
        const candidates = [];
        if (dish.image) candidates.push(dish.image);
        if (dish.image_url) candidates.push(dish.image_url);
        if (dish.img) candidates.push(dish.img);
        if (dish.images && Array.isArray(dish.images)) candidates.push(dish.images[0]);
        const src = candidates.find(s => s && String(s).trim());
        if (src) {
          const normalized = String(src).trim();
          if (!seen.has(normalized)) {
            seen.add(normalized);
            images.push({ src: normalized, alt: dish.name || dish.title || '' });
          }
        }
      }
    }
    return images;
  }

  function renderRestaurantImages(images) {
    const wrap = document.getElementById('restaurantImages');
    if (!wrap) return;
    wrap.innerHTML = '';
    if (!images || images.length === 0) return;
    const frag = document.createDocumentFragment();
    const maxImages = 4;
    const toRender = images.slice(0, maxImages);
    for (let i = 0; i < toRender.length; i++) {
      const it = toRender[i];
      const img = document.createElement('img');
      img.src = it.src;
      img.alt = it.alt || it.src;
      img.className = 'relative z-10 rounded-sm shadow-xl w-full h-80 object-cover warm-filter hover:scale-[1.02] transition-transform duration-500';
      //img.loading = 'lazy';
      img.decoding = 'async';
      if (i === 0) img.style.transform = 'translateY(3rem)';
      frag.appendChild(img);
    }
    wrap.appendChild(frag);
  }

  // ---------- FETCH BOTH JSON IN PARALLEL ----------
  try {
    const [menuRes, datiRes] = await Promise.all([
      fetch(MENU_JSON_PATH + '?_=' + Date.now(), { cache: 'no-store' }).catch(e => ({ ok: false, error: e })),
      fetch(DATA_JSON_PATH + '?_=' + Date.now(), { cache: 'no-store' }).catch(e => ({ ok: false, error: e }))
    ]);

    let menuJson = null;
    let datiJson = null;

    if (menuRes && menuRes.ok) {
      try { menuJson = await menuRes.json(); window.__MENU_JSON__ = menuJson; } catch(e){ console.warn('Errore parse menu.json', e); }
    } else {
      console.warn('menu.json non caricato', menuRes && menuRes.error ? menuRes.error : (menuRes && menuRes.status));
    }

    if (datiRes && datiRes.ok) {
      try { datiJson = await datiRes.json(); window.__DATA__ = datiJson; } catch(e){ console.warn('Errore parse dati.json', e); }
    } else {
      console.warn('dati.json non caricato', datiRes && datiRes.error ? datiRes.error : (datiRes && datiRes.status));
    }

    // 1) apply templating from dati.json (se presente)
    if (datiJson) {
      try {
        processRepeats(document, datiJson);
        bindAll(document, datiJson);
      } catch (e) {
        console.warn('Errore templating dati.json:', e);
      }
    }

    // 2) apply dati.json direct DOM updates (social, contact, cards, orari)
    if (datiJson) applyDatiToDOM(datiJson);

    // 3) render Menu using menu.json (se presente)
    (function renderMenuIfAvailable() {
      const titleEl = document.getElementById('menuTitle');
      const descEl = document.getElementById('menuDescription');
      const selector = document.getElementById('menuDaySelector');
      const tbody = document.getElementById('menuTableBody');

      if (!titleEl || !descEl || !selector || !tbody) {
        return;
      }

      if (!menuJson) {
        tbody.innerHTML = `<tr><td class="py-4" colspan="2">Menu non disponibile.</td></tr>`;
        return;
      }

      titleEl.textContent = menuJson.title || 'Menu';
      descEl.textContent = menuJson.description || '';

      const daysObj = (menuJson && menuJson.days && typeof menuJson.days === 'object') ? menuJson.days : {};
      const canonicalOrder = ['lunedì','martedì','mercoledì','giovedì','venerdì','sabato','domenica'];
      const daysArray = [];

      for (const rawKey of Object.keys(daysObj)) {
        const normalized = String(rawKey || '').trim().toLowerCase();
        const entry = daysObj[rawKey] || {};
        if (entry.enabled) {
          daysArray.push({
            key: normalized,
            title: entry.title || '',
            dishes: Array.isArray(entry.dishes) ? entry.dishes : [],
            isToday: false
          });
        }
      }

      const today = getTodayItalianLower();
      daysArray.forEach(d => { d.isToday = (d.key === today); });
      daysArray.sort((a,b) => {
        const ia = canonicalOrder.indexOf(a.key) >= 0 ? canonicalOrder.indexOf(a.key) : 99;
        const ib = canonicalOrder.indexOf(b.key) >= 0 ? canonicalOrder.indexOf(b.key) : 99;
        return ia - ib;
      });

      if (daysArray.length === 0) {
        selector.innerHTML = '';
        tbody.innerHTML = `<tr><td class="py-4" colspan="2">Nessun giorno del menu è abilitato al momento.</td></tr>`;
        return;
      }

      const todayItem = daysArray.find(d => d.isToday);
      const initial = todayItem ? todayItem.key : daysArray[0].key;

      function onSelect(dayKey) {
        const entry = daysArray.find(d => d.key === dayKey);
        if (!entry) return;
        renderDishes(tbody, entry.dishes);

        Array.from(selector.children).forEach(btn => {
          if (btn.dataset.day === dayKey) {
            btn.classList.remove('border-stone-200','dark:border-stone-700','text-gray-700','dark:text-gray-300');
            btn.classList.add('border-primary','text-primary');
            btn.setAttribute('aria-selected','true');
          } else {
            btn.classList.remove('border-primary','text-primary');
            btn.classList.add('border-stone-200','dark:border-stone-700','text-gray-700','dark:text-gray-300');
            btn.setAttribute('aria-selected','false');
          }
        });
      }

      buildDaySelector(selector, daysArray, initial, onSelect);
      onSelect(initial);

      // --- POPOLA LE IMMAGINI DELLA SEZIONE "Il Ristorante" ---
      const images = extractImagesFromMenu(menuJson);
      renderRestaurantImages(images);
    })();

  } catch (err) {
    console.error('Errore nello unified script:', err);
  }
}
)();
</script>
<script>
(function(){
  const nav = document.getElementById('siteNav');
  const header = document.querySelector('header');

  if (!nav || !header) return;

  function applyNavHeight(){
    // misura l'altezza reale della navbar (inclusi padding)
    const navRect = nav.getBoundingClientRect();
    const navH = Math.max(48, Math.round(navRect.height || 80)); // fallback minimo
    // imposta variabile CSS
    document.documentElement.style.setProperty('--site-nav-height', navH + 'px');
    // applica anche padding-top inline (utile se ci sono altre regole che sovrascrivono)
    header.style.paddingTop = `calc(${navH}px + env(safe-area-inset-top, 0px))`;

    // assicurati che l'indicatore "Scorri" sia figlio diretto dell'header (evita che venga tagliato)
    const scroll = header.querySelector('.scroll-indicator, .animate-bounce');
    if (scroll && scroll.parentElement !== header) {
      try { header.appendChild(scroll); } catch(e){ /* no-op */ }
    }

    // rendi l'indicatore più visibile
    if (scroll) {
      scroll.style.zIndex = 60;
      scroll.style.pointerEvents = 'none';
    }
  }

  // Esegui subito e in resize / DOM changes
  applyNavHeight();
  window.addEventListener('resize', applyNavHeight, {passive:true});
  // anche dopo mutate (es. logo caricato, fonts, ecc.)
  new MutationObserver(() => applyNavHeight()).observe(document.documentElement, {childList:true, subtree:true, attributes:true});
})();
</script>
            <script>
(function(){
  const header = document.querySelector('header') || document.querySelector('.header') || document.querySelector('.hero');
  const scroll = header ? header.querySelector('.scroll-indicator, .animate-bounce') : null;
  if (!scroll) return;

  // Cerca un possibile pulsante "Scopri la fattoria" (o CTA visibile)
  function findCTA(){
    const selectors = [
      '[data-cta]', '.cta', '.btn', '.button', '.discover', 'a[href*="scopri"]', 'button'
    ];

    const candidates = new Set();

    selectors.forEach(sel => {
      document.querySelectorAll(sel).forEach(el => candidates.add(el));
    });

    // ricerca testuale: "scopri la fattoria" o "scopri"
    document.querySelectorAll('a, button, div, span').forEach(el => {
      if (!el || !el.innerText) return;
      const t = el.innerText.trim().toLowerCase();
      if (t.includes('scopri la fattoria') || (t.includes('scopri') && t.length < 40)) candidates.add(el);
    });

    // filtra elementi visibili
    const visible = Array.from(candidates).filter(el => {
      const r = el.getBoundingClientRect();
      return r.width > 8 && r.height > 8 && r.bottom > 0 && r.top < window.innerHeight;
    });

    if (visible.length === 0) return null;

    // scegli il primo pulsante più vicino al bottom (quello che probabilmente è la CTA nel footer/hero)
    visible.sort((a,b) => b.getBoundingClientRect().top - a.getBoundingClientRect().top);
    return visible[0];
  }

  function avoidOverlap(){
    const cta = findCTA();
    // ripristina se non trova CTA
    if (!cta) {
      scroll.style.removeProperty('bottom');
      return;
    }

    const scrollRect = scroll.getBoundingClientRect();
    const btnRect = cta.getBoundingClientRect();

    // se NON si sovrappongono -> ok, lascia il bottom di default
    if (scrollRect.bottom <= btnRect.top || scrollRect.top >= btnRect.bottom) {
      scroll.style.removeProperty('bottom');
      return;
    }

    // se si sovrappongono -> calcola bottom in modo che l'indicatore stia subito sopra il pulsante
    const margin = 12; // px di gap tra indicatore e pulsante
    const safeBottom = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--safe-bottom-offset')) || 0;
    const desiredBottom = Math.max(8, Math.round(window.innerHeight - btnRect.top + margin - scrollRect.height + safeBottom));
    scroll.style.bottom = desiredBottom + 'px';

    // se, per qualche motivo, la posizione è ancora sbagliata (es. troppo alta), nascondi l'indicatore invece di coprire il bottone
    const newRect = scroll.getBoundingClientRect();
    if (!(newRect.bottom <= btnRect.top)) {
      scroll.style.opacity = '0'; // nascondi delicatamente
      // dopo breve timeout prova a ripristinare (utile se il bottone viene spostato poco dopo)
      setTimeout(() => { if (document.body.contains(scroll)) scroll.style.opacity = '1'; }, 600);
    } else {
      scroll.style.opacity = '1';
    }
  }

  // esegui subito e al resize / cambi DOM
  avoidOverlap();
  window.addEventListener('resize', avoidOverlap, {passive:true});
  window.addEventListener('orientationchange', avoidOverlap);
  new MutationObserver(avoidOverlap).observe(document.body, { childList:true, subtree:true, attributes:true });
})();
</script>

<!-- DEBUG & SOFT-FIX: highlights elements that overflow horizontally and applies safe max-width -->
<script>
(function(){
  function findAndFixOverflow(){
    const offenders = [];
    document.querySelectorAll('body *').forEach(el=>{
      if(!(el instanceof HTMLElement)) return;
      const r = el.getBoundingClientRect();
      if(r.width===0 || r.height===0) return;
      if(r.right > (window.innerWidth || document.documentElement.clientWidth) + 1){
        offenders.push(el);
        el.style.outline = '3px solid rgba(255,0,0,0.6)';
        el.style.transition = 'outline 300ms ease';
        el.style.maxWidth = '100%';
        el.style.overflowX = 'hidden';
        if(el.style.width && el.style.width.indexOf('100vw') !== -1){
          el.style.width = '100%';
        }
      }
    });
    if(offenders.length){
      console.log('Horizontal overflow: found', offenders.length, 'offending elements. They have been highlighted and soft-fixed (max-width:100%).');
      setTimeout(()=> offenders.forEach(el=> el.style.outline=''), 6000);
    } else {
      console.log('No horizontal overflow detected by the script.');
    }
  }

  window.addEventListener('load', findAndFixOverflow);
  window.addEventListener('resize', findAndFixOverflow);
  new MutationObserver(findAndFixOverflow).observe(document.documentElement, {childList:true, subtree:true, attributes:true});
})();
</script>

</body></html>

